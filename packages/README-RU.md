# Universo Platformo Laravel - Пакеты

⭐ **КРИТИЧЕСКИ ВАЖНО**: Этот каталог содержит **ВСЕ** модульные пакеты для Universo Platformo Laravel. **ВЕСЬ функционал ОБЯЗАТЕЛЬНО должен быть реализован как пакеты в этом каталоге.** Немодульная реализация строго запрещена.

Каждый пакет следует последовательной структуре и соглашению об именовании для обеспечения модульной разработки и будущего извлечения в отдельные репозитории.

## Мандат модульной архитектуры

**АБСОЛЮТНОЕ ТРЕБОВАНИЕ**: Весь функционал (кроме общих файлов запуска, корневой конфигурации и скриптов сборки) ОБЯЗАТЕЛЬНО должен быть реализован внутри пакетов в этом каталоге. Это **НЕ ПОДЛЕЖИТ ОБСУЖДЕНИЮ**:

- ✅ **ОБЯЗАТЕЛЬНО**: Создавать все функции как пакеты здесь
- ✅ **ОБЯЗАТЕЛЬНО**: Разделять фронтенд и бэкенд на отдельные пакеты
- ✅ **ОБЯЗАТЕЛЬНО**: Включать каталог `base/` в каждый пакет
- ✅ **ОБЯЗАТЕЛЬНО**: Создавать и README.md, и README-RU.md для каждого пакета
- ❌ **ЗАПРЕЩЕНО**: Реализовывать функции вне пакетов
- ❌ **ЗАПРЕЩЕНО**: Объединять фронтенд и бэкенд в один пакет
- ❌ **ЗАПРЕЩЕНО**: Создавать пакеты без каталога `base/`

Эта структура разработана для **workspace-пакетов** в монорепозитории с явной целью извлечения их в **отдельные репозитории** по мере развития проекта.

## Соглашение об именовании пакетов

Пакеты именуются в соответствии с их назначением и слоем:

- **Пакеты фронтенда**: `{имя-функции}-frt` (например, `clusters-frt`, `auth-frt`)
- **Пакеты бэкенда**: `{имя-функции}-srv` (например, `clusters-srv`, `auth-srv`)
- **Общие пакеты**: `universo-{назначение}-srv` (например, `universo-types-srv`, `universo-utils-srv`)

## Структура пакета

Каждый пакет **ОБЯЗАТЕЛЬНО** должен содержать подкаталог `base/` для своей базовой реализации:

```
packages/
├── feature-name-frt/
│   ├── base/                     # ⭐ ОБЯЗАТЕЛЬНАЯ базовая реализация фронтенда
│   │   ├── resources/            # Представления, компоненты, ресурсы
│   │   ├── routes/               # Маршруты фронтенда
│   │   └── composer.json         # Зависимости пакета (если нужны)
│   ├── README.md                 # ⭐ ОБЯЗАТЕЛЬНАЯ документация на английском
│   └── README-RU.md              # ⭐ ОБЯЗАТЕЛЬНАЯ документация на русском
└── feature-name-srv/
    ├── base/                     # ⭐ ОБЯЗАТЕЛЬНАЯ базовая реализация бэкенда
    │   ├── src/                  # Исходный код PHP
    │   ├── routes/               # Маршруты API
    │   ├── database/             # Миграции, наполнители
    │   ├── tests/                # Тесты пакета
    │   └── composer.json         # Зависимости пакета
    ├── README.md                 # ⭐ ОБЯЗАТЕЛЬНАЯ документация на английском
    └── README-RU.md              # ⭐ ОБЯЗАТЕЛЬНАЯ документация на русском
```

**ОБЯЗАТЕЛЬНЫЙ** подкаталог `base/` позволяет создавать будущие альтернативные реализации с сохранением обратной совместимости.

## Категории пакетов

### Основные пакеты

**Аутентификация и профили**
- `auth-frt` / `auth-srv` - Аутентификация пользователей и управление сеансами
- `profile-frt` / `profile-srv` - Профили и предпочтения пользователей

### Управление контентом

**Кластеры** (Три уровня: Кластеры → Домены → Ресурсы)
- `clusters-frt` / `clusters-srv` - Функциональность управления кластерами
- Организационная структура для ресурсов

**Метавселенные** (Три уровня: Метавселенные → Секции → Сущности)
- `metaverses-frt` / `metaverses-srv` - Управление виртуальными мирами
- Инструменты создания и редактирования миров

**Уники** (Расширенная иерархия)
- `uniks-frt` / `uniks-srv` - Созданные пользователями юниты/персонажи
- Прогрессия персонажей и инвентарь

### Продвинутые функции

**Пространства и холсты**
- `spaces-frt` / `spaces-srv` - Пространства визуального программирования
- `space-builder-frt` / `space-builder-srv` - Редактор на основе узлов

**Публикация**
- `publish-frt` / `publish-srv` - Система публикации контента
- Контроль версий и развёртывание

### Вспомогательные пакеты

**Утилиты**
- `universo-types` - Общие определения типов
- `universo-utils` - Общие утилиты
- `universo-i18n` - Поддержка интернационализации
- `universo-api-client` - Библиотека клиента API

## Создание нового пакета

1. **Создайте структуру каталогов**
   ```bash
   mkdir -p packages/myfeature-frt/base
   mkdir -p packages/myfeature-srv/base
   ```

2. **Добавьте composer.json пакета** (если у пакета есть собственные зависимости)
   ```json
   {
     "name": "universo/myfeature-frt",
     "type": "library",
     "require": {
       "php": "^8.2"
     },
     "autoload": {
       "psr-4": {
         "Universo\\MyFeature\\Frontend\\": "base/src/"
       }
     }
   }
   ```

3. **Зарегистрируйте в корневом composer.json**
   ```json
   {
     "repositories": [
       {
         "type": "path",
         "url": "packages/myfeature-frt"
       },
       {
         "type": "path",
         "url": "packages/myfeature-srv"
       }
     ],
     "require": {
       "universo/myfeature-frt": "@dev",
       "universo/myfeature-srv": "@dev"
     }
   }
   ```

4. **Создайте двуязычную документацию**
   - `packages/myfeature-frt/README.md` (английский)
   - `packages/myfeature-frt/README-RU.md` (русский)

## Руководство по разработке пакетов

### Разделение ответственности

- **Пакеты фронтенда** (`-frt`): UI компоненты, представления, клиентская логика, ресурсы фронтенда
- **Пакеты бэкенда** (`-srv`): API endpoints, бизнес-логика, модели данных, миграции базы данных

### Интеграция бэкенда и фронтенда с Inertia.js

Laravel + Inertia.js устраняет необходимость в традиционном слое REST API между пакетами фронтенда и бэкенда. Вместо этого данные передаются напрямую из контроллеров Laravel в компоненты Vue.js.

#### Паттерн интеграции

**Пакет бэкенда** (`-srv`) предоставляет:
- Контроллеры, использующие `Inertia::render()`
- API Resources для преобразования данных
- Form Requests для валидации
- Policies для авторизации

**Пакет фронтенда** (`-frt`) предоставляет:
- Компоненты страниц Vue.js
- Переиспользуемые UI компоненты (на основе Vuetify)
- Утилиты на стороне клиента

**Пример интеграции**:

```php
// Бэкенд: packages/clusters-srv/base/routes/api.php
use Universo\Clusters\Controllers\ClusterController;

Route::middleware(['auth'])->group(function () {
    Route::get('/clusters', [ClusterController::class, 'index'])
        ->name('clusters.index');
    Route::post('/clusters', [ClusterController::class, 'store'])
        ->name('clusters.store');
});
```

```php
// Бэкенд: packages/clusters-srv/base/src/Controllers/ClusterController.php
use Inertia\Inertia;

class ClusterController extends Controller
{
    public function index()
    {
        return Inertia::render('Clusters/Index', [
            'clusters' => ClusterResource::collection(
                auth()->user()->clusters()->get()
            )
        ]);
    }
}
```

```vue
<!-- Фронтенд: packages/clusters-frt/base/resources/js/Pages/Index.vue -->
<template>
  <div>
    <h4 class="text-h4 mb-4">Кластеры</h4>
    <v-card v-for="cluster in clusters.data" :key="cluster.id">
      <v-card-title>{{ cluster.name }}</v-card-title>
    </v-card>
  </div>
</template>

<script setup>
defineProps({
  clusters: Object
})
</script>
```

#### Общие данные между пакетами

Для данных, используемых в нескольких пакетах, используйте общие пакеты:
- `universo-types-srv` - PHP интерфейсы и DTO
- `universo-utils-srv` - Вспомогательные функции
- В будущем: `universo-components-frt` - Общие компоненты Vue.js/Vuetify

#### API endpoints для внешнего доступа

Хотя Inertia.js обрабатывает рендеринг страниц, вам всё ещё могут понадобиться REST API endpoints для:
- Мобильных приложений
- Внешних интеграций
- AJAX запросов
- Webhook'ов

Размещайте их в `routes/api.php` с соответствующими API Resources и аутентификацией.

### Зависимости

- Пакеты должны объявлять свои собственные зависимости в своём `composer.json`
- Межпакетные зависимости разрешены, но должны быть минимизированы
- Используйте внедрение зависимостей для слабой связанности

### Тестирование

- Каждый пакет должен иметь свой набор тестов
- Тесты расположены в каталоге `tests/` пакета
- Запуск всех тестов пакетов: `php artisan test`

### Документация

- Каждый пакет должен иметь README.md (английский) и README.ru.md (русский)
- Документация должна иметь идентичную структуру и количество строк
- Включайте примеры использования и документацию API

## Шаблон трёхуровневых сущностей

Многие пакеты следуют шаблону трёхуровневых сущностей, который обеспечивает последовательную иерархическую структуру:

**Уровень 1 → Уровень 2 → Уровень 3**

Примеры:
- **Кластеры**: Кластеры → Домены → Ресурсы
- **Метавселенные**: Метавселенные → Секции → Сущности
- **Организации**: Организации → Отделы → Члены

Этот шаблон может быть адаптирован с большим или меньшим количеством уровней в зависимости от конкретных требований.

## Жизненный цикл пакета

1. **Разработка**: Пакеты разрабатываются в каталоге `packages/`
2. **Интеграция**: Регистрируются в корневом composer.json для разработки в монорепозитории
3. **Извлечение** (В будущем): Пакеты могут быть перемещены в отдельные репозитории с сохранением совместимости
4. **Версионирование**: После извлечения пакеты следуют семантическому версионированию

## Миграция с версии React

При реализации функций из [universo-platformo-react](https://github.com/teknokomo/universo-platformo-react):

1. Проанализируйте реализацию на React для понимания основных концепций
2. Адаптируйте к лучшим практикам Laravel/PHP
3. Сохраняйте те же границы функций и структуру пакетов
4. Не копируйте плохие реализации - улучшайте их
5. Синхронизируйте документацию между реализациями

## Статус пакетов

Текущие пакеты в разработке:

- [ ] `auth-frt` / `auth-srv` - Аутентификация (запланировано)
- [ ] `profile-frt` / `profile-srv` - Профили пользователей (запланировано)
- [ ] `clusters-frt` / `clusters-srv` - Кластеры (запланировано - первая реализация)
- [ ] `metaverses-frt` / `metaverses-srv` - Метавселенные (запланировано)
- [ ] `uniks-frt` / `uniks-srv` - Уники (запланировано)
- [ ] `spaces-frt` / `spaces-srv` - Пространства (запланировано)
- [ ] `publish-frt` / `publish-srv` - Публикация (запланировано)

## Ресурсы

- [Разработка пакетов Laravel](https://laravel.com/docs/11.x/packages)
- [Репозитории путей Composer](https://getcomposer.org/doc/05-repositories.md#path)
- [Universo Platformo React](https://github.com/teknokomo/universo-platformo-react) - Эталонная реализация

---

По вопросам разработки пакетов см. главный [README.md](../README.md) или свяжитесь с командой разработчиков.
